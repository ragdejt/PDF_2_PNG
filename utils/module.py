#--------------------------------------------------------------------------------------------------#
# Import necessary libraries.                                                                      #
#--------------------------------------------------------------------------------------------------#
import os
import time
import fitz
from pathlib import Path
from rich import print
from tqdm import tqdm
#--------------------------------------------------------------------------------------------------#
# Variables.                                                                                       #
#--------------------------------------------------------------------------------------------------#

#--------------------------------------------------------------------------------------------------#
# Path's                                                                                           #
#--------------------------------------------------------------------------------------------------#
user_path = Path.home()
script_path = user_path / ("PDF_2_PNG")
png_folder = script_path / ("PNG")
pdf_folder = script_path / ("PDF")
#--------------------------------------------------------------------------------------------------#
# Create directory                                                                                 #
#--------------------------------------------------------------------------------------------------#
def create_directory():
    script_path.mkdir(exist_ok=True)
    png_folder.mkdir(exist_ok=True)
    pdf_folder.mkdir(exist_ok=True)
#--------------------------------------------------------------------------------------------------#
# Date / Time.                                                                                     #
#--------------------------------------------------------------------------------------------------#
def date_time():
    print(time.strftime(f"[%H:%M:%S] - [%d/%m/%Y]").center(100, "-"))
    input("[Press ENTER to continue]".center(100, "-"))
#--------------------------------------------------------------------------------------------------#
# List PDF folder.                                                                                 #
#--------------------------------------------------------------------------------------------------#
def list_pdf_folder():
    print(
        """[green]
██████╗ ██████╗ ███████╗    ███████╗ ██████╗ ██╗     ██████╗ ███████╗██████╗ 
██╔══██╗██╔══██╗██╔════╝    ██╔════╝██╔═══██╗██║     ██╔══██╗██╔════╝██╔══██╗
██████╔╝██║  ██║█████╗      █████╗  ██║   ██║██║     ██║  ██║█████╗  ██████╔╝
██╔═══╝ ██║  ██║██╔══╝      ██╔══╝  ██║   ██║██║     ██║  ██║██╔══╝  ██╔══██╗
██║     ██████╔╝██║         ██║     ╚██████╔╝███████╗██████╔╝███████╗██║  ██║
╚═╝     ╚═════╝ ╚═╝         ╚═╝      ╚═════╝ ╚══════╝╚═════╝ ╚══════╝╚═╝  ╚═╝
[/]"""
    )
    print("\n[List PDF folder]\n")
    for i, dir in enumerate(os.listdir(pdf_folder), start=1):
        print(f"[{i}]:", f"[green]{dir}[/]")
    date_time()
#--------------------------------------------------------------------------------------------------#
# List PNG folder.                                                                                 #
#--------------------------------------------------------------------------------------------------#
def list_png_folder():
    print(
        """[green]
  ██████╗ ███╗   ██╗ ██████╗     ███████╗ ██████╗ ██╗     ██████╗ ███████╗██████╗ 
  ██╔══██╗████╗  ██║██╔════╝     ██╔════╝██╔═══██╗██║     ██╔══██╗██╔════╝██╔══██╗
  ██████╔╝██╔██╗ ██║██║  ███╗    █████╗  ██║   ██║██║     ██║  ██║█████╗  ██████╔╝
  ██╔═══╝ ██║╚██╗██║██║   ██║    ██╔══╝  ██║   ██║██║     ██║  ██║██╔══╝  ██╔══██╗
  ██║     ██║ ╚████║╚██████╔╝    ██║     ╚██████╔╝███████╗██████╔╝███████╗██║  ██║
  ╚═╝     ╚═╝  ╚═══╝ ╚═════╝     ╚═╝      ╚═════╝ ╚══════╝╚═════╝ ╚══════╝╚═╝  ╚═╝                                                                                  
[/]"""
    )
    print("\n[List PNG folder]\n")
    for i, dir in enumerate(os.listdir(png_folder), start=1):
        print(f"[{i}]:", f"[green]{dir}[/]")
    date_time()
#--------------------------------------------------------------------------------------------------#
# PDF_2_PNG.                                                                                       #
#--------------------------------------------------------------------------------------------------#
def pdf_2_png():
    try:
        print(
            """
  ██████╗ ██████╗ ███████╗                ██████╗                 ██████╗ ███╗   ██╗ ██████╗ 
  ██╔══██╗██╔══██╗██╔════╝                ╚════██╗                ██╔══██╗████╗  ██║██╔════╝ 
  ██████╔╝██║  ██║█████╗                   █████╔╝                ██████╔╝██╔██╗ ██║██║  ███╗
  ██╔═══╝ ██║  ██║██╔══╝                  ██╔═══╝                 ██╔═══╝ ██║╚██╗██║██║   ██║
  ██║     ██████╔╝██║         ███████╗    ███████╗    ███████╗    ██║     ██║ ╚████║╚██████╔╝
  ╚═╝     ╚═════╝ ╚═╝         ╚══════╝    ╚══════╝    ╚══════╝    ╚═╝     ╚═╝  ╚═══╝ ╚═════╝                                                                                           
    """
        )
        print("\n[PDF_2_PNG]\n")
        pdf_name = str(input("[Enter the name of the PDF you want to convert]:"))
        pdf_path = pdf_folder / (pdf_name + ".pdf")
        png_path = png_folder / (pdf_name)
        if os.path.exists(pdf_path):
            png_path.mkdir()
            file = fitz.open(pdf_path) 
            for page_num in tqdm(range(file.page_count)): # Iterate over all pages in the PDF file
                page = file[page_num] # Get the current page
                image = page.get_pixmap() # Render the page into an image
                image_path = os.path.join(png_path , f"Pagina_{page_num + 1}.png")
                image.save(image_path)
            print(
                "[green][Conversion Completed][/]\n"
                f"[Pages]: {file.page_count}"
            )
        else:
            print("[Error]: File not found")
    except FileExistsError:
        pass
#--------------------------------------------------------------------------------------------------#
# Menu.                                                                                            #
#--------------------------------------------------------------------------------------------------#
def menu():
    while True:
        print(
            """[green]
  ███╗   ███╗███████╗███╗   ██╗██╗   ██╗
  ████╗ ████║██╔════╝████╗  ██║██║   ██║
  ██╔████╔██║█████╗  ██╔██╗ ██║██║   ██║
  ██║╚██╔╝██║██╔══╝  ██║╚██╗██║██║   ██║
  ██║ ╚═╝ ██║███████╗██║ ╚████║╚██████╔╝
  ╚═╝     ╚═╝╚══════╝╚═╝  ╚═══╝ ╚═════╝ 
    [/]"""
        )
        print(
            "\n[Menu Principal]\n"
            "[Enter one of the available options]:\n"
            "[0]: [green]Exit[/]\n"
            "[1]: [green]List PDF folder[/]\n"
            "[2]: [green]List PNG folder[/]\n"
            "[3]: [green]PDF_2_PNG[/]\n"        
        )
        menu_input = int(input("[Your answer]: "))
        match menu_input:
            case 0:
                exit()
            case 1:
                list_pdf_folder()
            case 2:
                list_png_folder()
            case 3:
                pdf_2_png()
